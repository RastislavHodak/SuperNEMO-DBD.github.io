<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Falaise: FLSimulate Output</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Falaise
   &#160;<span id="projectnumber">2.1.0</span>
   </div>
   <div id="projectbrief">SuperNEMO Software Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">FLSimulate Output </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#flsimulateoutput_introduction">Introduction to the FLSimulate Output </a></li>
<li class="level1"><a href="#flsimulateoutput_thegeometryidentifierconcept">The geometry identifier concept </a></li>
<li class="level1"><a href="#flsimulateoutput_mctoolsbasestephitclass">The mctools::base_step_hit class </a></li>
<li class="level1"><a href="#flsimulateoutput_mctoolssimulateddata">The mctools::simulated_data class </a></li>
<li class="level1"><a href="#flsimulateoutput_truthcalorimeterhits">The truth calorimeter hits </a></li>
<li class="level1"><a href="#flsimulateoutput_truthtrackerhits">The truth tracker hits </a></li>
<li class="level1"><a href="#flsimulateoutput_exampleofsimulatedeventinthesupernemodemonstrator">An example of simulated event in the SuperNEMO demonstrator </a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="flsimulateoutput_introduction"></a>
Introduction to the FLSimulate Output </h1>
<p>The current official simulation application defines an output data model to represent the detector response (SuperNEMO demonstrator module, BiPo3...). Each <em>simulated</em> event record is implemented through the generic <code>datatools::things</code> container object that handle a dedicated data bank which is conventionaly named <code>SD</code> (<b>S</b> imulated <b>D</b> ata).</p>
<p>In the future, the simulation application will also support the creation of the <em>digitization data</em> <code>DD</code> bank (<b>D</b> igitization <b>D</b> ata).</p>
<p>Here we describe the contents of the data model produced by the SuperNEMO Monte-Carlo program.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;+----------------------------------+</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;| Event record (datatools::things) |</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;+----------------------------------+</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;          |</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        +----+</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        | SD |----- {this is a bank}</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        +----+</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;         /</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        /</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;+------+------+</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;| Monte-Carlo |</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;|   output    |</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;+-------------+</div></div><!-- fragment --><h1><a class="anchor" id="flsimulateoutput_thegeometryidentifierconcept"></a>
The geometry identifier concept </h1>
<p>A very important concept, massively used within the Falaise simulation and data processing, is the <em>geometry identifier</em> (GID). A GID is an object that uniquely identifies a geometry volume in the experimental setup. Given some dedicated rules, the description of the virtual geometry of the experiment is able to associate such an unique GID to each volumes of interest in the geometry (this technique is called <em>geometry mapping</em> and is under the responsibility of the <em>geometry manager</em> object and its embedded <em>GID manager</em> object).</p>
<p>What is important to know about any GID object is that it stores two kinds of information:</p>
<ul>
<li><p class="startli">the <em>geometry type</em> is an unique positive integer identifier that indicates which type of geometry volume is addressed by the GID. A <em>geometry type</em> is conventionaly associated to a <em>geometry category</em> which is an unique human readable string (the list of <em>geometry types and categories</em> supported by a given experimental setup is defined in a special configuration file).</p>
<p class="startli">The table below presents some official geometry categories of interest in the SuperNEMO demonstrator geometry:</p>
</li>
</ul>
<table class="doxtable">
<tr>
<th>Category </th><th>Type </th><th>Address contents </th><th>Description </th><th>Example  </th></tr>
<tr>
<td><code>"world"</code> </td><td><code>0</code> </td><td><em>world</em> number </td><td>Conventionaly identifies the world volume </td><td>[0:0] represents the top-level geometry volume </td></tr>
<tr>
<td><code>"module"</code> </td><td><code>1000</code> </td><td><em>module</em> number </td><td>Identifies any detector module </td><td>[1000:0] represents the demonstrator module </td></tr>
<tr>
<td><code>"source_strip"</code> </td><td><code>1102</code> </td><td><em>module</em> and <em>strip</em> numbers </td><td>Identifies any source foil strip </td><td>[1102:0.3] represents the fourth strip in the demonstrator module </td></tr>
<tr>
<td><code>"tracker_submodule"</code> </td><td><code>1200</code> </td><td><em>module</em> and <em>side</em> numbers </td><td>Identifies any tracker submodule </td><td>[1200:0.1] represents the French side tracker in the demonstrator module </td></tr>
<tr>
<td><code>"tracker_layer"</code> </td><td><code>1202</code> </td><td><em>module</em>, <em>side</em> and <em>layer</em> numbers </td><td>Identifies any tracker layer of drift cells </td><td>[1202:0.1.8] represents the layer near the wall in the French side tracker </td></tr>
<tr>
<td><code>"drift_cell_core"</code> </td><td><code>1204</code> </td><td><em>module</em>, <em>side</em>, <em>layer</em> and <em>row</em> numbers </td><td>Identifies any tracker drift cell </td><td>[1204:0.1.8.112] represents the cell at the French/Tunnel corner of the tracking chamber </td></tr>
<tr>
<td><code>"xcalo_block"</code> </td><td><code>1232</code> </td><td><em>module</em>, <em>side</em>, <em>wall</em>, <em>column</em> and <em>row</em> numbers </td><td>Identifies any X-calo block </td><td>[1232:0.1.1.0.15] represents the block at the French/Tunnel top corner of the detector </td></tr>
<tr>
<td><code>"gveto_block"</code> </td><td><code>1252</code> </td><td><em>module</em>, <em>side</em>, <em>wall</em> and <em>column</em> numbers </td><td>Identifies any gamma veto block </td><td>[1252:0.1.1.15] represents the block at the French/Tunnel top corner of the detector </td></tr>
<tr>
<td><code>"calorimeter_block"</code> </td><td><code>1302</code> </td><td><em>module</em>, <em>side</em>, <em>column</em>, <em>row</em> and <em>part</em> numbers </td><td>Identifies any main calorimeter block </td><td>[1302:0.1.19.12.1] represents the front part of the scintillator block at the French/Tunnel top corner of the detector </td></tr>
</table>
<ul>
<li>the <em>address</em> of the GID is an ordered collection of positive integer identifiers that informs about the effective positioning of the volume in the geometry hierarchy : module (only 0 for the demonstrator), side number (italian/french), source strip number (from 0 to 35), main clorimeter column (from 0 to 19), Geiger cell layer (from 0 to 8)...</li>
</ul>
<p>It is thus possible to extract these informations from any GID object.</p>
<p>Example with GID with value [1200:0.1] :</p><ul>
<li><p class="startli">Q: What is your type (or category) ?</p>
<p class="startli">A: The GID will respond <code>1200</code> (this is the type associated to the <code>"tracker_submodule"</code> geometry category)</p>
</li>
<li><p class="startli">Q: What is the depth of your address ?</p>
<p class="startli">A: The GID will respond <code>2</code> because the full path of address is made of two numbers, namely the <em>module</em> number (at rank <code>0</code>) and the <em>tracker submodule</em> number (at rank <code>1</code>).</p>
</li>
<li><p class="startli">Q: What is your address of rank <code>0</code> ?</p>
<p class="startli">A: The GID will respond <code>0</code> (this is the <em>module</em> number, here the demonstrator module is conventionaly numbered <code>0</code>).</p>
</li>
<li><p class="startli">Q: What is your address of rank <code>1</code> ?</p>
<p class="startli">A: The GID will respond <code>1</code> (this is the French <em>tracker submodule</em> number in the geometry convention of the experiment).</p>
</li>
</ul>
<p>The GID object is thus the unique repository where to store the geometrical identification and localization of a volume and particularly for Monte-Carlo truth hits.</p>
<p>The figure below illustrates the identification of the volumes traverses by simulated electron tracks in the SuperNEMO demonstrator module:</p>
<div class="image">
<img src="fls_demonstrator_geom_ids_0.jpg" alt="fls_demonstrator_geom_ids_0.jpg"/>
<div class="caption">
Two simulated electron tracks traversing several volumes of the detector associated to various geometry categories.</div></div>
<p>From this example, we can determine the geometry identifiers (GIDs) associated to these volumes, thanks to the <em>mapping</em> and <em>locator</em> mechanisms implemented in the geometry modelling manager:</p><ul>
<li>The two electrons are emitted from a source strip (green segment on the right). This source strip volume belongs to the <code>"source_strip"</code> geometry category (type 1102). It is the last one placed in the source frame. Its geometry identifier is [1102:0.35] with module number 0 and source strip number 35.</li>
<li><p class="startli">The first truth track (bottom) traverses the drift volumes of 11 Geiger cells (blue squares) of which the geometry category is <code>"drift_cell_core"</code> (type 1204). All the hit cells are in the Italian side of the demonstrator module. The corresponding GIDS are:</p><ul>
<li>[1204:0.0.0.110] is associated to the cell close to the vertex represented by a small square in the source foil; the GID address consists in module number O, side number 0 (Italian side), layer number 0 (near the source frame) and row number 110 (one of the last 9-cells rows on the Tunnel side),</li>
<li>[1204:0.0.1.110],</li>
<li>[1204:0.0.2.110],</li>
<li>[1204:0.0.3.110],</li>
<li>[1204:0.0.3.111],</li>
<li>[1204:0.0.4.111],</li>
<li>[1204:0.0.5.111],</li>
<li>[1204:0.0.6.111],</li>
<li>[1204:0.0.7.111],</li>
<li>[1204:0.0.8.111],</li>
<li>[1204:0.0.8.112] is associated to the cell at the top left corner of the Italian tracker submodule (in the "C1" C-shape).</li>
</ul>
<p class="startli">Then the first track terminates in the front part of a scintillator block (category <code>"calorimeter_block"</code>) of the Italian main wall (left purple rectangle). Its GID is [1302:0.0.19.11.1] which means:</p><ul>
<li>module number 0 (demonstrator module),</li>
<li>side number 0 (Italian),</li>
<li>column number 19 (the last column in the calorimeter main wall on the Tunnel side on the Y axis),</li>
<li>row number 11 (not visible here on this X-Y projection),</li>
<li>part number 1 (because these scintillator blocks are modeled in two parts, the back part which is an extruded scintillator block on the photomultiplier side (part number is 0) and the front block which is a simple scintillator block on the tracker side (part number is 1)).</li>
</ul>
</li>
<li><p class="startli">The second truth track (top) traverses the drift volumes of 2 Geiger cells (blue squares) of which the GIDs are:</p><ul>
<li>[1204:0.0.0.111] nearest the vertex,</li>
<li>[1204:0.0.0.112] nearest the X-calo scintillator block.</li>
</ul>
<p class="startli">The track terminates in a scintillator block (category <code>"xcalo_block"</code>) at the Tunnel side of the Italian main wall (top purple rectangle). Its GID is [1232:0.0.1.0.8] which means:</p><ul>
<li>module number 0 (demonstrator module),</li>
<li>side number 0 (Italian),</li>
<li>wall number 1 (Tunnel side on the Y axis),</li>
<li>column number 0 (the first column near the source frame on the X axis),</li>
<li>row number 8 (not visible here on this X-Y projection).</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="flsimulateoutput_mctoolsbasestephitclass"></a>
The mctools::base_step_hit class </h1>
<p>The Bayeux/mctools Geant4 plugin used by the FLSimulate application is designed to generate collections of <em>truth step hits</em> through the Geant4 simulation engine. The output data model contains objects that represents such truth hits. It uses the <code>mctools::base_step_hit</code> class. The <code>mctools::base_step_hit</code> class inherits the <code>geomtools::base_hit</code> class.</p>
<p>Each object of the <code>mctools::base_step_hit</code> class contains:</p><ul>
<li>the unique identifier of the truth hit, with respect to the collection it belongs to (an integer, inherited from the <code>geomtools::base_hit</code> mother class),</li>
<li>the geometry identifier (GID) of the volume where the hit was generated, if available (a <code>geomtools::geom_id</code> instance, inherited from the <code>geomtools::base_hit</code> mother class),</li>
<li>a collection of optional auxiliary properties (a <code>datatools::properties</code> instance, inherited from the <code>geomtools::base_hit</code> mother class),</li>
<li>the start position of the step hit (a <code>geomtools::vector_3d</code> instance),</li>
<li>the stop position of the step hit (a <code>geomtools::vector_3d</code> instance),</li>
<li>the start time of the step hit (a real value in unit of time),</li>
<li>the stop time of the step hit (a real value in unit of time),</li>
<li>the start momentum of the step hit (a real value in unit of energy),</li>
<li>the stop momentum of the step hit (a real value in unit of energy),</li>
<li>the energy deposit along the track segment (a real value in unit of energy),</li>
<li>the particle name (a character string provided by Geant4).</li>
</ul>
<p>The recording of these basic attributes is optional. Users are free to parametrized only a subset of truth step's attributes to be stored in the output data model. This is configured while combining the sensitive detector associated to some volumes and the step hit processor attached to the sensitive detector. Note also that the meaning and the need of these attributes may change depending of the nature of the sensitive detector.</p>
<p>Note that the collection of auxiliary properties can be used to store, on user request, additional informations like:</p><ul>
<li>the identifier of the corresponding G4 truth hit (a positive integer value provided by Geant4),</li>
<li>the name of step processor that produced the truth hit (a character string),</li>
<li>the identifier of the G4 track (a positive integer value provided by Geant4),</li>
<li>the identifier of the parent G4 track (a positive integer value provided by Geant4),</li>
<li>the kinetic energy of the particle at the beginning of the step (a real value in unit of energy),</li>
<li>the kinetic energy of the particle at the end of the step (a real value in unit of energy),</li>
<li>the <em>primary particle</em> flag (a boolean value set to <code>1</code> for a primary particle, equivalent to parent track identifier set to <code>0</code>),</li>
<li>the name of the G4 creator process (a character string provided by Geant4),</li>
<li>the name of the G4 creator category (a character string provided by Geant4),</li>
<li>the <em>delta-ray from alpha</em> flag (a boolean value set to <code>1</code> for a low-energy secondary electron generated along the track of an an alpha particle, typically used to compute the quenching factor in some material),</li>
<li>the <em>entering volume</em> flag (a boolean value set to <code>1</code> for a particle entering a volume by Geant4),</li>
<li>the <em>leaving volume</em> flag (a boolean value set to <code>1</code> for a particle leaving a volume by Geant4),</li>
<li>the name of the G4 volume (a character string provided by Geant4),</li>
<li>the copy number of the G4 volume (a positive integer value provided by Geant4).</li>
</ul>
<p>Given a collection of such truth hits, it is expected that users will be able to apply some arbitrary digitization algorithm.</p>
<h1><a class="anchor" id="flsimulateoutput_mctoolssimulateddata"></a>
The mctools::simulated_data class </h1>
<p>The <code>SD</code> bank created by the simulation within each event record contains a <code>mctools::simulated_data</code> object.</p>
<p>Each <code>mctools::simulated_data</code> object contains:</p><ul>
<li>the primary vertex (a <code>geomtools::vector_3d</code> instance),</li>
<li>the primary generated event (particle types and kinematics, a <code>genbb::primary_event</code> instance),</li>
<li>a collection of optional auxiliary properties (a <code>datatools::properties</code> instance),</li>
<li>a dictionary of collections of shared handles to <code>mctools::base_step_hit</code> objects. This dictionary owns several collection of truth hits (eventually managed through <em>shared handles</em>, see <a class="el" href="flreconstructpipelineoutput.html#flreconstructpipelineoutput_thesharedhandleconcept">here</a>), depending on the parametrization of the simulation output profiles. For the SuperNEMO demonstrator, we use the following collections of truth hits:<ul>
<li><p class="startli"><code>"calo"</code> : calorimeter truth hits collected from the scintillator blocks in the main walls.</p>
<p class="startli">These hits are built from G4 raw truth hits by the <code>calorimeter.hit_processor</code> step hit backend processor.</p>
</li>
<li><p class="startli"><code>"xcalo"</code> : calorimeter truth hits collected from the scintillator blocks in the X-walls.</p>
<p class="startli">These hits are built from G4 raw truth hits by the <code>xcalorimeter.hit_processor</code> step hit backend processor.</p>
</li>
<li><p class="startli">"`gveto"` : calorimeter truth hits collected from the gamma veto scintillator blocks</p>
<p class="startli">These hits are built from G4 raw truth hits by the <code>gveto.hit_processor</code> step hit backend processor.</p>
</li>
<li><p class="startli"><code>"gg"</code> : Geiger hits collected from the tracker cell drift region (considering the Geiger regime).</p>
<p class="startli">These hits are built from G4 raw truth hits by the <code>gg.hit_processor</code> step hit backend processor.</p>
</li>
<li><p class="startli"><code>"__visu.track"</code> : raw truth step hits collected from various part of the detector including not onmy the sensitive detectors (scintillator blocks, Geiger cells) but also some non-sensitive volumes of the geometry (source foil strips...).</p>
<p class="startli">These hits are built from G4 raw truth hits by many step hit backend processors of the <code>mctools::push_all_step_hit_processor</code> class. They are only generated for specific output profiles and not produced by default.</p>
</li>
</ul>
</li>
</ul>
<p>Each <code>genbb::primary_event</code> object contains:</p><ul>
<li>the time of the decay (a real value in unit of time),</li>
<li>the list of primary particles (<code>genbb::primary_particle</code> instances),</li>
<li>the name of the event generator (a character string),</li>
<li>a collection of auxiliary properties (a <code>datatools::properties</code> instance).</li>
</ul>
<p>Each <code>genbb::primary_particle</code> object contains:</p><ul>
<li>the type of the particle (an integer value, based on an extended Geant3 nomenclature),</li>
<li>the optional PDG particle code (an integer value),</li>
<li>the optional label describing the particle (a character string),</li>
<li>the optional mass of the particle (a real positive value),</li>
<li>the time of emission of the particle (a real value in unit of time),</li>
<li>the original momentum of the emitted particle (a <code>geomtools::vector_3d</code> instance),</li>
<li>the optional vertex from where the particle was emitted (a <code>geomtools::vector_3d</code> instance),</li>
<li>a collection of auxiliary properties (a <code>datatools::properties</code> instance).</li>
</ul>
<h1><a class="anchor" id="flsimulateoutput_truthcalorimeterhits"></a>
The truth calorimeter hits </h1>
<p>The <code>"calo"</code> , <code>"xcalo"</code> and <code>"gveto"</code> collections of truth hits are generated by their respective backend step processors of the type <code><a class="el" href="classsnemo_1_1simulation_1_1calorimeter__step__hit__processor.html" title="A basic processor of simulated step hits in SuperNEMO calorimeter blocks. ">snemo::simulation::calorimeter_step_hit_processor</a></code>.</p>
<p>The principle of this algorithm is to collect all raw step hits generated by Geant4 in a given scintillator block (sensitive volume) and to build an unique resulting truth hit that sums up the total energy deposit along all these raw steps. The final <em>calorimeter hit</em> records the following attributes in the output <code>mctools::base_step_hit</code> object (see <a class="el" href="flsimulateoutput.html#flsimulateoutput_mctoolsbasestephitclass">this section</a>):</p><ul>
<li>the unique identifier of the hit in the collection,</li>
<li>the GID locating the scintillator block where the raw hits were produced (type is <code>1302</code> for main wall blocks, <code>1232</code> for X-calorimeter blocks and <code>1252</code> for gamma veto blocks),</li>
<li>a collection of optional auxiliary properties (a <code>datatools::properties</code> instance).</li>
<li>the first position of the corner of the bounding box that wraps all the raw hits (a <code>geomtools::vector_3d</code> instance),</li>
<li>the second position of the opposite corner of the bounding box that wraps all the raw hits (a <code>geomtools::vector_3d</code> instance),</li>
<li>the first and last timestamp associated to the total energy deposit in the block (two real values in unit of time),</li>
<li>the total energy deposit (a real value in unit of energy).</li>
</ul>
<p>The figure below illustrates how a calorimeter hit (the red box) is built by the <code><a class="el" href="classsnemo_1_1simulation_1_1calorimeter__step__hit__processor.html" title="A basic processor of simulated step hits in SuperNEMO calorimeter blocks. ">snemo::simulation::calorimeter_step_hit_processor</a></code> processor from a collection of raw G4 truth step hits (in blue) traversing a given scintillator block.</p>
<div class="image">
<img src="fls_calorimeter_step_hit_processor_0.jpg" alt="fls_calorimeter_step_hit_processor_0.jpg"/>
<div class="caption">
A mctools::base_step_hit object built by the snemo::simulation::calorimeter_step_hit_processor processor for the "calo" collection of hits.</div></div>
 <h1><a class="anchor" id="flsimulateoutput_truthtrackerhits"></a>
The truth tracker hits </h1>
<p>The <code>"gg"</code> collection of truth hits is generated by a dedicated backend <code><a class="el" href="classsnemo_1_1simulation_1_1gg__step__hit__processor.html" title="A basic processor of simulated step hits in some drift cell in Geiger regime. ">snemo::simulation::gg_step_hit_processor</a></code> processor.</p>
<p>The principle of this algorithm is to analyze all raw step hits generated by Geant4 in the fiducial drift region of a given Geiger cell (sensitive volume) and to randomize the creation of ion/electron first ionization pairs along the truth track. The created truth pair that is located at the nearest position to the anode wire is considered as the one that triggers the cell, others truth pairs are simply ignored. The final <em>tracker hit</em> records the following attributes in the output <code>mctools::base_step_hit</code> object (see <a class="el" href="flsimulateoutput.html#flsimulateoutput_mctoolsbasestephitclass">this section</a>):</p><ul>
<li>the unique identifier of the hit in the collection,</li>
<li>the GID locating the Geiger cell where the raw tracker truth hits were produced (geometry type is <code>1204</code>),</li>
<li>a collection of optional auxiliary properties (<code>datatools::properties</code>), for example the position of the <em>minimal approach position</em> (MAP) and drift distance of the truth track with respect to the anode wire,</li>
<li>the position of the creation of the truth ion/electron pair (<code>geomtools::vector_3d</code>),</li>
<li>the position of the impact of the Geiger avalanche on the anode wire (<code>geomtools::vector_3d</code>),</li>
<li>the time of creation of the truth ion/electron pair.</li>
</ul>
<p>The figure below illustrates how a tracker hit is built by the <code><a class="el" href="classsnemo_1_1simulation_1_1gg__step__hit__processor.html" title="A basic processor of simulated step hits in some drift cell in Geiger regime. ">snemo::simulation::gg_step_hit_processor</a></code> processor from a collection of raw G4 truth step hits (in blue) traversing the drift region of a given Geiger cell.</p>
<div class="image">
<img src="fls_gg_step_hit_processor_0.jpg" alt="fls_gg_step_hit_processor_0.jpg"/>
<div class="caption">
A mctools::base_step_hit object built by the snemo::simulation::gg_step_hit_processor processor for the "gg" collection of hits.</div></div>
<p> We can see that, due to the randomization of the electron/ion first ionization pairs, the position of the truth electron/ion pair that triggers the cell (and thus will be used for the track measurement) does not exactly matches the minimal approach point (MAP, in purple) which is theoriticaly computed from the positions of the raw truth step and the anode wire. This will result in a small bias in the reconstruction of the drift distance during the calibration step. Together with the multiple scattering of electrons (and positrons) in the tracking gas and the time resolution of the tracker electronics, this is a source of experimental error in the reconstruction of the charged particles' trajectories.</p>
<h1><a class="anchor" id="flsimulateoutput_exampleofsimulatedeventinthesupernemodemonstrator"></a>
An example of simulated event in the SuperNEMO demonstrator </h1>
<p>The figure below show a simulated neutrinoless double beta decay of Se-82 from the source foil in the SuperNEMO demonstrator. The display of truth tracks, calorimeter hits and tracker hits is activated.</p>
<div class="image">
<img src="fls_demonstrator_sd_0.jpg" alt="fls_demonstrator_sd_0.jpg"/>
<div class="caption">
An example of a simulated neutrinoless double beta decay of Se-82 from the source foil in the SuperNEMO demonstrator.</div></div>
<p> The lines below shows the structure of the corresponding output <code>mctools::simulated_data</code> object which is stored in the <code>SD</code> bank of the event record.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Simulated data :</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;|-- Properties : &lt;empty&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;|   `-- &lt;no property&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;|-- Collection type : 1</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;|-- Collections of step hit handles :</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;|   |-- Category &#39;__visu.tracks&#39; has 325 hit(s) [capacity=325]</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;|   |-- Category &#39;calo&#39; has 2 hit(s) [capacity=2]</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;|   `-- Category &#39;gg&#39; has 26 hit(s) [capacity=26]</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;|-- Primary event :</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;|   |-- Auxiliary properties: &lt;none&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;|   |-- Label : &#39;Se82.0nubb&#39;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;|   |-- Time  : 0 s</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;|   |-- Particles: [2]</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;|   |   |-- Particle #0 :</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;|   |   |   |-- Type           : 3 (label=&#39;e-&#39;)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;|   |   |   |-- PDG code       : &lt;none&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;|   |   |   |-- Mass           : 0.510999 MeV</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;|   |   |   |-- Charge         : -1 e</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;|   |   |   |-- Time           : 0 ns</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;|   |   |   |-- Kinetic energy : 1.82335 MeV</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;|   |   |   |-- Momentum       : (-2.17652,-0.564218,0.364033) MeV</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;|   |   |   |-- Vertex         : &lt;no vertex&gt;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;|   |   |   |-- Auxiliary properties: &lt;none&gt;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;|   |   |   `-- Valid          : 1</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;|   |   `-- Particle #1 :</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;|   |       |-- Type           : 3 (label=&#39;e-&#39;)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;|   |       |-- PDG code       : &lt;none&gt;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;|   |       |-- Mass           : 0.510999 MeV</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;|   |       |-- Charge         : -1 e</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;|   |       |-- Time           : 0 ns</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;|   |       |-- Kinetic energy : 1.17165 MeV</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;|   |       |-- Momentum       : (1.12332,-0.536882,-1.01) MeV</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;|   |       |-- Vertex         : &lt;no vertex&gt;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;|   |       |-- Auxiliary properties: &lt;none&gt;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;|   |       `-- Valid          : 1</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;|   |-- GENBB weight : 1</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;|   |-- Classification : &#39;2e0p0g0a0X&#39;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;|   `-- Valid: 1</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;`-- Vertex : (-0.0348284,-391.675,-377.86) mm</div></div><!-- fragment --><p>We can check that the vertex position, the nature and initial kinematics of generated particles are stored in the data structure:</p><ul>
<li>vertex position along the X axis is -0.0348284 mm which clearly shows that it lies in the bulk volume of one of the source foil strips (167 micrometers in this geometry setup used for the simulation),</li>
<li>the primary event contains the two electrons emitted by the neutrinoless double beta decay of Se-82 (we check that their energy sum match the Q value of the decay: 2995 keV).</li>
</ul>
<p>The name of the event generator (<code>Se82.0nubb</code>) is also recorded.</p>
<p>The bank contains three collections of truth hits created by the backend processors of the Bayeux/mctools Geant4 driver used in FLSimulate:</p><ul>
<li>The <code>__visu.tracks</code> collection contains 325 truth Geant4 raw step hits collected from all volumes of interest as defined by the step hit processors that have been activated by the output profile chosen by the user,</li>
<li>The 'calo' collection contains 2 truth calorimeter-like hits,</li>
<li>The 'gg' collection contains 26 truth Geiger-like hits.</li>
</ul>
<p>This result has been obtained by activating the <code>"all_details"</code> output profile. This illustrates that the <code>__visu.tracks</code> collection may typically store one order of magnitude more raw truth hits than the one collected in other collection of hits. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
